from flask import Flask, render_template, jsonify
from azure.storage.blob import BlobServiceClient
import json

app = Flask(__name__)

# Azure Blob Storage connection string
BLOB_CONNECTION_STRING = "your_blob_storage_connection_string"
BLOB_CONTAINER_NAME = "your_blob_container_name"
BLOB_FILE_NAME = "your_blob_file_name.json"

@app.route('/')
def index():
    return render_template('index2.html')

@app.route('/get_latest_data', methods=['GET'])
def get_latest_data():
    blob_service_client = BlobServiceClient.from_connection_string(BLOB_CONNECTION_STRING)
    container_client = blob_service_client.get_container_client(BLOB_CONTAINER_NAME)
    blob_client = container_client.get_blob_client(BLOB_FILE_NAME)

    try:
        blob_data = blob_client.download_blob().readall().decode('utf-8')
        latest_data = json.loads(blob_data)
        return jsonify(latest_data)
    except Exception as e:
        print(f"Error reading blob data: {e}")
        return jsonify({'error': 'Unable to fetch data'})

if __name__ == '__main__':
    app.run(debug=True)
